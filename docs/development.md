# 生日倒计时工具开发文档

## 1. 技术架构

### 1.1 架构概述

生日倒计时工具采用前端单页应用架构，使用原生JavaScript实现核心功能，通过Webpack进行构建和打包。项目采用模块化设计，确保代码的可维护性和可扩展性。

### 1.2 技术栈

- **前端基础**：HTML5, CSS3, JavaScript (ES6+)
- **构建工具**：Webpack 5
- **CSS处理**：MiniCssExtractPlugin
- **模板引擎**：EJS
- **国际化**：自定义I18n管理器
- **部署**：静态网站托管

### 1.3 项目结构

```
/
├── docs/                 # 项目文档
├── src/                  # 源代码
│   ├── i18n/             # 国际化文件
│   │   ├── en.js         # 英语翻译
│   │   ├── zh.js         # 中文翻译
│   │   └── ...           # 其他语言
│   ├── i18n-manager.js   # 国际化管理器
│   ├── index.ejs         # HTML模板
│   ├── index.js          # 应用入口
│   └── styles.css        # 全局样式
├── webpack.config.js     # Webpack配置
├── package.json          # 项目依赖
└── README.md             # 项目说明
```

## 2. 开发环境

### 2.1 环境要求

- **Node.js**: v14.0.0 或更高版本
- **npm**: v6.0.0 或更高版本
- **操作系统**: 跨平台支持 (Windows, macOS, Linux)
- **浏览器**: 最新版本的Chrome, Firefox, Safari, Edge

### 2.2 开发工具推荐

- **代码编辑器**: Visual Studio Code
- **浏览器开发工具**: Chrome DevTools
- **版本控制**: Git
- **API测试**: Postman (如需与后端交互)

### 2.3 环境设置

1. **克隆项目**:
   ```bash
   git clone <repository-url>
   cd infra
   ```

2. **安装依赖**:
   ```bash
   npm install
   ```

3. **启动开发服务器**:
   ```bash
   npx webpack serve --port 8081 --open
   ```

4. **构建生产版本**:
   ```bash
   npm run build
   ```

## 3. 核心模块说明

### 3.1 国际化模块 (i18n)

国际化模块通过`i18n-manager.js`实现，负责加载和切换不同语言的翻译文件。每种语言的翻译存储在`src/i18n/`目录下的独立文件中。

**主要功能**:
- 语言检测与设置
- 翻译文本加载
- 动态切换语言
- RTL语言支持

### 3.2 倒计时模块

倒计时模块是应用的核心，负责计算并显示距离目标日期的剩余时间。

**主要功能**:
- 日期差值计算
- 实时倒计时更新
- 格式化时间显示
- 生日到达时的特殊处理
- 默认生日日期设置为当前年份减去18年

### 3.3 UI模块

UI模块负责应用的视觉呈现和用户交互。

**主要功能**:
- 响应式布局
- 主题管理
- 动画效果
- 用户输入处理

## 4. 开发规范

### 4.1 代码规范

- **JavaScript**: 遵循ESLint配置的规则
- **CSS**: 使用BEM命名约定
- **命名**: 使用驼峰命名法(camelCase)命名变量和函数，使用帕斯卡命名法(PascalCase)命名类
- **注释**: 为所有函数和复杂逻辑添加JSDoc风格的注释

### 4.2 Git工作流

- 使用feature分支进行功能开发
- 提交信息遵循约定式提交规范
- 通过Pull Request进行代码审查
- 主分支保持稳定可发布状态

### 4.3 测试策略

- 单元测试: 使用Jest测试核心功能
- 集成测试: 确保模块间正确交互
- 端到端测试: 使用Cypress验证用户流程
- 跨浏览器测试: 确保在所有目标浏览器中正常工作

## 5. 部署指南

### 5.1 构建流程

1. 确保所有依赖已安装:
   ```bash
   npm install
   ```

2. 构建生产版本:
   ```bash
   npm run build
   ```

3. 构建产物将输出到`dist/`目录

### 5.2 部署选项

#### 5.2.1 静态网站托管

可以将构建产物部署到任何静态网站托管服务:

- GitHub Pages
- Netlify
- Vercel
- AWS S3 + CloudFront
- Firebase Hosting

#### 5.2.2 自托管

1. 将`dist/`目录内容复制到Web服务器的根目录
2. 配置服务器支持SPA路由(如需)
3. 设置适当的缓存策略和HTTPS

### 5.3 持续集成/持续部署 (CI/CD)

推荐设置CI/CD流程以自动化构建和部署:

1. 在每次推送到主分支时触发构建
2. 运行测试确保质量
3. 成功后自动部署到生产环境

## 6. 性能优化

### 6.1 已实施的优化

- CSS文件抽取与压缩
- JavaScript代码分割
- 资源文件名添加内容哈希以优化缓存
- 懒加载非关键资源

### 6.2 推荐的进一步优化

- 实施服务工作线程(Service Worker)实现离线功能
- 使用资源预加载
- 图片优化与WebP格式支持
- 关键CSS内联

## 7. 故障排除

### 7.1 常见问题

1. **构建失败**
   - 检查Node.js和npm版本
   - 清除node_modules并重新安装依赖
   - 检查webpack配置文件语法

2. **样式问题**
   - 确认CSS加载器配置正确
   - 检查浏览器兼容性设置
   - 验证CSS变量支持

3. **国际化问题**
   - 确保所有语言文件格式一致
   - 检查RTL支持配置
   - 验证所有文本都已翻译

### 7.2 调试技巧

- 使用浏览器开发工具检查网络请求和控制台错误
- 启用webpack的详细日志输出
- 使用断点调试JavaScript代码
- 检查浏览器本地存储数据